<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.dao.ICarDao">

  <resultMap id="vehicleResultMap" type="com.example.entity.Vehicle">
    <id property="id" column="vehicle_id" />
    <result property="vin" column="vehicle_vin"/>
    <result property="year" column="vehicle_year"/>
    <result property="make" column="vehicle_make"/>
    <result property="model" column="vehicle_model"/>
    <result property="color" column="vehicle_color"/>
    <result property="vehicleType" column="vehicle_type" />
    <collection property="serviceRecordIds" ofType="java.lang.Long" javaType="java.util.Set">
      <result column="service_record_id" />
    </collection>
  </resultMap>

  <resultMap id="userResultMap" type="com.example.entity.User">
    <result property="id" column="id" />
    <result property="firstName" column="first_name" />
    <result property="lastName" column="last_name" />
  </resultMap>

  <resultMap id="carResultMap" type="com.example.entity.Car" extends="vehicleResultMap">
    <result property="doorCount" column="car_door_count"/>
  </resultMap>

  <resultMap id="carOwnershipResultMap" type="com.example.entity.CarOwnership">
    <association property="car" resultMap="carResultMap" />
    <association property="user" resultMap="userResultMap" />
  </resultMap>

  <select id="getCarOwnership" resultMap="carOwnershipResultMap">
    select vehicle.id as vehicle_id,
           vehicle.vin as vehicle_vin,
           vehicle.year as vehicle_year,
           vehicle.make as vehicle_make,
           vehicle.model as vehicle_model,
           vehicle.color as vehicle_color,
           vehicle.type as vehicle_type,
           car.door_count as car_door_count,
           user.id as id,
           user.first_name as first_name,
           user.last_name as last_name,
           service_record.id as service_record_id
    from vehicle
      join user on (vehicle.user_id = user.id)
      left join car on (vehicle.id = car.id)
      left join service_record on (vehicle.id = service_record.vehicle_id)
    where vehicle.type = 'car'
  </select>
</mapper>
